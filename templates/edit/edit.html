{% extends 'layouts/layout.html' %}
{% block content %}
<form method="POST" id="form" class="{{ 'rich-editor-enabled' if config['RICH_EDITOR_ENABLED'] else '' }}">
    {{ form.csrf_token }}
    <div class="controls">
        {% if languages %}
        <div class="select-wrapper">
            {{ form.extension(aria_label='Programming Language') }}
        </div>
        {% endif %}
        <div class="select-wrapper indent-control rich-disabled">
            <label for="indent" class="sr-only">Indentation</label>
            <select class="indent">
                <optgroup label="Spaces">
                    <option value="spaces-2">2 spaces</option>
                    <option value="spaces-4">4 spaces</option>
                    <option value="spaces-8">8 spaces</option>
                </optgroup>
                <optgroup label="Tabs">
                    <option value="tabs-2">Tabs (2 spaces)</option>
                    <option value="tabs-4">Tabs (4 spaces)</option>
                    <option value="tabs-8">Tabs (8 spaces)</option>
                </optgroup>
            </select>
        </div>
        <button class="btn btn-primary float-right"><span aria-hidden="true">save</span><span class="sr-only">save snippet</span></button>
    </div>
    <div class="editor-container">
        {% if config.RICH_EDITOR_ENABLED %}
        <div class="lines"></div>
        {% endif %}
        {{ form.text(spellcheck='false', placeholder='type or paste some code') }}
        <div class="editor rich-disabled" id="editor" contenteditable spellcheck="false">{{ text|default('', true) }}</div>
    </div>
</form>
{% if form.errors %}
<div class="alert alert-warning alert-dismissable alert-autohide alert-toast fade-in" id="error-messages">
    <button class="alert-close" type="button" data-target="#error-messages">
        <span class="sr-only">close alert</span>
        <span aria-hidden="true">Ã—</span>
    </button>
    <ul>
        {% for field, errors in form.errors.items() %}
            {% for error in errors %}
                <li>{{ error }}</li>
            {% endfor %}
        {% endfor %}
    </ul>
</div>
{% endif %}
{% endblock %}
{% block bottom_scripts %}
<script src="/static/bundle.js?{{ cache_buster }}"></script>
<script>
window.addEventListener('load', function () {
    form = document.querySelector('.rich-editor-enabled');
    if(form) {
        editor = new RichEditor(form);
    }


    document.querySelectorAll('.alert-autohide').forEach((el) => {
        setTimeout(() => {
            el.classList.add('fade-out-start');
        }, 5000);
        setTimeout(() => {
            el.remove();
        }, 7000);
    });

    document.querySelectorAll('.fade-in').forEach((el) => {
        el.classList.add('fade-in-start');
    });

    document.querySelectorAll('.alert-close').forEach((el) => {
        el.addEventListener('click', (event) => {
            const target = document.querySelector(el.dataset.target);
            if (target) {
                target.classList.add('fade-out-start');
                setTimeout(() => {
                    target.remove();
                }, 2000);
            }
        });
    });
});
</script>
{% endblock %}
